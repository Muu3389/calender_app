<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カレンダーアプリ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>

    <!-- イベント追加／編集フォーム -->
    <form id="event-form" class="event-form" method="POST" action="/add">
        <input type="hidden" id="event-id" name="event-id">
        <input type="hidden" id="event-color" name="event-color">

        <h3>予定を追加 / 編集</h3>

        <label>
            日付:
            <input type="text" id="event-date" name="event-date" readonly>
        </label>

        <label>
            時間:
            <input type="time" id="event-time" name="event-time">
        </label>

        <label>
            内容:
            <input type="text" id="event-text" name="event-text" placeholder="予定内容を入力">
        </label>

        <!-- カラー選択 -->
        <div class="color-picker" aria-label="予定カラーを選択">
            {% set colors = [
                '#e8f0fe', '#ffe4e1', '#fff3cd', '#d4edda',
                '#cce5ff', '#f8d7da', '#e2e3e5', '#d1ecf1'
            ] %}
            {% for color in colors %}
                <span class="color-option" data-color="{{ color }}" style="background: {{ color }};"></span>
            {% endfor %}
        </div>

        <!-- 操作ボタン -->
        <div class="form-buttons">
            <button type="submit" id="save-event">保存</button>
            <button type="button" id="delete-event">削除</button>
            <button type="button" id="cancel-event">キャンセル</button>
        </div>
    </form>

    <!-- 年月ナビゲーション -->
    <header>
        <form method="get" class="jump-form">
            <select name="year" id="year-select" onchange="this.form.submit()">
                {% for y in range(year-5, year+6) %}
                    <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}年</option>
                {% endfor %}
            </select>

            <select name="month" id="month-select" onchange="this.form.submit()">
                {% for m in range(1, 13) %}
                    <option value="{{ m }}" {% if m == month %}selected{% endif %}>{{ m }}月</option>
                {% endfor %}
            </select>
        </form>
    </header>

    <!-- 月移動ボタン -->
    <nav class="nav">
        <a href="/?year={{ year if month > 1 else year-1 }}&month={{ month-1 if month > 1 else 12 }}">
            <button type="button">前の月</button>
        </a>
        <a href="/?year={{ year if month < 12 else year+1 }}&month={{ month+1 if month < 12 else 1 }}">
            <button type="button">次の月</button>
        </a>
    </nav>

    <!-- カレンダー -->
    <table class="calendar">
        <thead>
            <tr class="weekday-row">
                {% for w in ['日', '月', '火', '水', '木', '金', '土'] %}
                    <th>{{ w }}</th>
                {% endfor %}
            </tr>
        </thead>

        <tbody>
            {% for week in month_days %}
            <tr>
                {% for day in week %}
                    {% if day == 0 %}
                        <td class="empty"></td>
                    {% else %}
                        {% set date_str = "%04d-%02d-%02d" | format(year, month, day) %}
                        <td data-date="{{ date_str }}" class="day-cell">
                            <div class="day-number">{{ day }}</div>
                            <div class="event-list">
                                {% if day in events %}
                                    {% for event in events[day] %}
                                        <div class="event"
                                             data-id="{{ event[3] }}"
                                             style="background-color: {{ event[2] }};">
                                            {% if event[0] %}
                                                <span class="event-time">{{ event[0] }}</span>
                                            {% endif %}
                                            <span class="event-title">{{ event[1] }}</span>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </td>
                    {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
